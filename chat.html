<!doctype html>
<html>
<head>
    <title>Intergram!</title>
    <link rel="stylesheet" type="text/css" href="https://idoco.github.io/intergram/style.css">
</head>
<body>

<ol id="messages" class="chat"></ol>

<input id="m" class="textarea" type="text" placeholder="Type here!"/>

<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<script>

    writeToMessages("Hello! How can we help you?", 'other');

    var userId = Math.random().toString(36).substr(2, 5); // 5 random chars
    var chatId = getUrlParameter('id');

    var socket = io.connect('https://intergram.herokuapp.com');

    socket.emit('register', {
        chatId: chatId,
        userId: userId
    });

    socket.on(chatId, writeToMessages);
    socket.on(chatId+"-"+userId, writeToMessages);

    $('#m').keyup(function (e) {
        if (e.keyCode == 13) {
            var msg = $('#m').val();
            $('#m').val('');
            writeToMessages("You: " + msg, 'self');
            socket.send(msg);
        }
    });

    function writeToMessages(msg, writeAs) {
        $('#messages').append(
            "<li class=\"" + (writeAs || 'other') + "\"><div class=\"msg\">" +
                msg +
            "</div></li>");
        window.scrollTo(0,document.body.scrollHeight)
    }

    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

</script>
</body>
</html>
